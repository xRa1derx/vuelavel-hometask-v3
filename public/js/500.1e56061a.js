"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[500],{4999:function(e,t,a){a.d(t,{V:function(){return s}});const s={beforeMount:function(e,t){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||t.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}},7955:function(e,t,a){a.d(t,{d:function(){return i}});var s=a(1020),n=a(4870);const i=(0,s.Q_)("adminStore",(()=>{const e=(0,n.iH)({isOpen:!1});return{adminSidebar:e}}))},500:function(e,t,a){a.r(t),a.d(t,{default:function(){return ce}});var s=a(3396),n=a(7139),i=a(4870),l=a(9242),u=(a(7658),a(4161)),c=a(1020),o=a(2483);const r=(0,c.Q_)("chatStore",(()=>{const e=(0,i.iH)(),t=(0,i.iH)(!1),a=(0,i.iH)(""),n=(0,i.iH)({text:"",uuid:""}),l=(0,i.iH)({replyMessage:"",uuid:"",action:null}),c=(0,i.iH)({uuid:"",action:null,initialText:""}),r=(0,i.iH)({action:null,uuid:null}),d=(0,i.iH)({action:null,uuid:null}),g=(0,o.yj)(),p=(e=null)=>{t.value=!0,"delete"===e&&(r.value.action="delete",S(e,n.value.uuid))},v=()=>{r.value={action:null,uuid:null},t.value=!1},m=()=>t.value,h=async(t,a)=>{await u.Z.get(`/api/chat/${t||a}`).then((t=>{e.value=t.data}))},_=()=>e.value,y=t=>{e.value?.unshift(t),b(),U()},x=t=>{e.value?.filter((e=>{e.uuid===c.value.uuid&&(e.message=t)})),w()},M=()=>{let t=r.value.uuid||d.value.uuid;t?.forEach((t=>{u.Z.delete(`/api/chat/${t}`).then((t=>{e.value=e.value?.filter((e=>e.uuid!=t.data))})),t===c.value.uuid&&(console.log("here"),w())})),U(),v()},f=(e,t)=>{n.value.text=e,n.value.uuid=t},S=(e=null,t)=>{"massDelete"===e?(d.value.action="massDelete",d.value?.uuid||(d.value.uuid=[]),d.value.uuid?.includes(t)?d.value.uuid.splice(d.value.uuid.indexOf(t),1):d.value.uuid?.push(t)):"delete"===e?(r.value.uuid=[],r.value.uuid.push(t)):"edit"===e?(b(),c.value.uuid="",c.value.initialText=n.value.text,c.value.uuid=t,c.value.action="edit"):"reply"===e&&(w(),l.value={replyMessage:n.value.text,uuid:t,action:e})},U=()=>{const e=document.querySelectorAll(".chat__message-content");[...e].forEach((e=>{e.classList.contains("selected")&&e.classList.remove("selected")})),d.value={uuid:null,action:null}},w=()=>{c.value={initialText:"",action:null,uuid:""},a.value=""},b=()=>{l.value={replyMessage:"",uuid:"",action:null}};return(0,s.YP)((()=>d),(()=>{d.value.uuid?.length||"massDelete"!==d.value.action||(d.value.action=null,d.value.uuid=null);const e=document.querySelector(".textarea__chat-mass-del-btn");e&&("massDelete"===d.value.action?(e.style.width="60px",e.style.marginLeft="5px"):(e.style.width="0px",e.style.marginLeft="0px"))}),{deep:!0}),(0,s.YP)(g,(()=>{U(),w()})),{getChatData:_,getChat:h,addMessage:y,deleteMessage:M,setMessageAction:S,getModalState:m,closeModal:v,openModal:p,setMessage:f,editMessage:x,resetEditingMessage:w,resetReplyMessage:b,textarea:a,selectedMessage:n,replyActionsWithMessage:l,editActionsWithMessage:c,singleDeleteMessage:r,massDeleteMessage:d}})),d={key:0,class:"chat__quote"},g={class:"chat-message-text"};var p=(0,s.aZ)({__name:"ChatMessageComponent",props:{message:{type:Object},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){const a=e,u=(0,i.iH)(),c=r();function o(e){c.setMessageAction("massDelete",e),u.value.classList.toggle("selected")}function p(e,s){c.setMessage(a.message.message,a.message.uuid),t("contextMenu",e,s)}return(t,i)=>((0,s.wg)(),(0,s.iD)("div",{class:"chat__message-content",ref_key:"message",ref:u,onClick:i[1]||(i[1]=e=>o(a.message?.uuid))},[(0,s._)("div",{onClick:i[0]||(i[0]=(0,l.iM)((e=>p(e,a.message?.uuid)),["stop"])),class:(0,n.C_)(["chat__message",[e.authStoreUserId===a.message?.sender.id?"sender":"receiver"]])},[a.message?.replyMessage?((0,s.wg)(),(0,s.iD)("p",d,(0,n.zw)(a.message?.replyMessage),1)):(0,s.kq)("",!0),(0,s._)("p",g,(0,n.zw)(a.message?.message),1)],2)],512))}}),v=a(89);const m=(0,v.Z)(p,[["__scopeId","data-v-2771f318"]]);var h=m;const _={class:"chat__message-day"},y={class:"chat__message-container"};var x=(0,s.aZ)({__name:"ChatDayComponent",props:{messages:{type:Object},date:{type:String},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){const a=e;function i(e,a){t("contextMenu",e,a)}return(t,l)=>((0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",_,(0,n.zw)(a.date),1),(0,s._)("div",y,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.messages,(t=>((0,s.wg)(),(0,s.j4)(h,{key:t.id,onContextMenu:i,message:t,authStoreUserId:e.authStoreUserId},null,8,["message","authStoreUserId"])))),128))])],64))}});const M=(0,v.Z)(x,[["__scopeId","data-v-d42f393e"]]);var f=M;const S=e=>((0,s.dD)("data-v-67377350"),e=e(),(0,s.Cn)(),e),U=S((()=>(0,s._)("button",{class:"chat-context-menu-btn"},"Добавить файлы",-1)));var w=(0,s.aZ)({__name:"ChatContextMenu",props:["clientX","clientY"],emits:["close-context-menu"],setup(e,{emit:t}){const a=r();function l(){a.setMessageAction("reply",a.selectedMessage.uuid)}function u(){a.setMessageAction("edit",a.selectedMessage.uuid)}return(t,c)=>((0,s.wg)(),(0,s.iD)("div",{onClick:c[3]||(c[3]=e=>t.$emit("close-context-menu")),class:"chat__context-menu",style:(0,n.j5)({left:e.clientX+"px",top:e.clientY+"px"})},[U,(0,s._)("button",{onClick:c[0]||(c[0]=e=>l()),class:"chat-context-menu-btn"}," Ответить "),(0,s._)("button",{onClick:c[1]||(c[1]=e=>u()),class:"chat-context-menu-btn"}," Редактировать "),(0,s._)("button",{onClick:c[2]||(c[2]=e=>(0,i.SU)(a).openModal("delete")),class:"chat-context-menu-btn"}," Удалить ")],4))}});const b=(0,v.Z)(w,[["__scopeId","data-v-67377350"]]);var C=b,D=a(1005),k=a(4999);const I={class:"modal__text-delete"},A={class:"modal__del-buttons"};var H=(0,s.aZ)({__name:"ChatListComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=r(),u=(0,i.iH)({isActive:!1,uuid:null}),c=(0,i.iH)(0),o=(0,i.iH)(0),d=(0,i.iH)();function g(e,t){!1===u.value.isActive?(v(e),u.value.isActive=!u.value.isActive):v(e),u.value.uuid=t}function p(){u.value.uuid=null,u.value.isActive=!u.value.isActive}function v(e){let t=document.documentElement.clientWidth/2,a=document.documentElement.clientHeight/2;const s=document.querySelector(".admin-page__sidebar").clientWidth;let n=window.innerWidth-(d.value.clientWidth+s);t<e.pageX?c.value=Math.floor(e.clientX-(n/2+s)-130):c.value=Math.floor(e.clientX-(n/2+s)+10),a<e.clientY?o.value=e.clientY+d.value.scrollTop-280:o.value=e.clientY+d.value.scrollTop-120}function m(e){let t=e.created_at.slice(0,16).replace("T"," "),a=t.split(/[- :]/),s=new Date(Date.UTC(a[0],a[1]-1,a[2],a[3],a[4]));return s}(0,s.bv)((()=>a.getChat(t.routeId,t.authStoreUserId)));const h=(0,s.Fl)((()=>{const e=a.getChatData()?.reduce(((e,t)=>{const a=m(t).toLocaleString().slice(0,10);return e[a]=e[a]||[],e[a].push(t),e}),{});return e}));return(t,r)=>((0,s.wg)(),(0,s.iD)("div",{class:"chat",ref_key:"chatBlock",ref:d},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.value,((t,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"chat__messages",key:t[0].id},[(0,s.Wm)(f,{messages:t,date:a,authStoreUserId:e.authStoreUserId,onContextMenu:g},null,8,["messages","date","authStoreUserId"])])))),128)),u.value.isActive?(0,s.wy)(((0,s.wg)(),(0,s.j4)(C,{key:0,clientX:c.value,clientY:o.value,onCloseContextMenu:p},null,8,["clientX","clientY"])),[[(0,i.SU)(k.V),p]]):(0,s.kq)("",!0),(0,s.Wm)(l.uT,{name:"opacity"},{default:(0,s.w5)((()=>[(0,i.SU)(a).getModalState()?((0,s.wg)(),(0,s.j4)(D.Z,{key:0,onCloseModal:r[2]||(r[2]=e=>(0,i.SU)(a).closeModal())},{header:(0,s.w5)((()=>[(0,s._)("p",I," Вы действительно хотите удалить "+(0,n.zw)(1==(0,i.SU)(a).massDeleteMessage.uuid?.length||"delete"===(0,i.SU)(a).singleDeleteMessage.action?"это сообщение":"эти сообщения")+"? ",1)])),body:(0,s.w5)((()=>[(0,s._)("div",A,[(0,s._)("button",{class:"btn",onClick:r[0]||(r[0]=e=>(0,i.SU)(a).deleteMessage())}," Да "),(0,s._)("button",{class:"btn",onClick:r[1]||(r[1]=e=>(0,i.SU)(a).closeModal())}," Нет ")])])),_:1})):(0,s.kq)("",!0)])),_:1})],512))}});const W=(0,v.Z)(H,[["__scopeId","data-v-31fb6356"]]);var Z=W;const q="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var z={randomUUID:q};a(1439),a(7585),a(5315);let Y;const E=new Uint8Array(16);function T(){if(!Y&&(Y="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y(E)}const L=[];for(let oe=0;oe<256;++oe)L.push((oe+256).toString(16).slice(1));function j(e,t=0){return L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]}function O(e,t,a){if(z.randomUUID&&!t&&!e)return z.randomUUID();e=e||{};const s=e.random||(e.rng||T)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=s[e];return t}return j(s)}var V=O,X=a(7183);const N=e=>((0,s.dD)("data-v-8cbcddda"),e=e(),(0,s.Cn)(),e),P={class:"textarea-wrapper"},R=N((()=>(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg","clip-rule":"evenodd","fill-rule":"evenodd","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision","image-rendering":"optimizeQuality",viewBox:"0 0 456 511.82"},[(0,s._)("path",{d:"M48.42 140.13h361.99c17.36 0 29.82 9.78 28.08 28.17l-30.73 317.1c-1.23 13.36-8.99 26.42-25.3 26.42H76.34c-13.63-.73-23.74-9.75-25.09-24.14L20.79 168.99c-1.74-18.38 9.75-28.86 27.63-28.86zM24.49 38.15h136.47V28.1c0-15.94 10.2-28.1 27.02-28.1h81.28c17.3 0 27.65 11.77 27.65 28.01v10.14h138.66c.57 0 1.11.07 1.68.13 10.23.93 18.15 9.02 18.69 19.22.03.79.06 1.39.06 2.17v42.76c0 5.99-4.73 10.89-10.62 11.19-.54 0-1.09.03-1.63.03H11.22c-5.92 0-10.77-4.6-11.19-10.38 0-.72-.03-1.47-.03-2.23v-39.5c0-10.93 4.21-20.71 16.82-23.02 2.53-.45 5.09-.37 7.67-.37zm83.78 208.38c-.51-10.17 8.21-18.83 19.53-19.31 11.31-.49 20.94 7.4 21.45 17.57l8.7 160.62c.51 10.18-8.22 18.84-19.53 19.32-11.32.48-20.94-7.4-21.46-17.57l-8.69-160.63zm201.7-1.74c.51-10.17 10.14-18.06 21.45-17.57 11.32.48 20.04 9.14 19.53 19.31l-8.66 160.63c-.52 10.17-10.14 18.05-21.46 17.57-11.31-.48-20.04-9.14-19.53-19.32l8.67-160.62zm-102.94.87c0-10.23 9.23-18.53 20.58-18.53 11.34 0 20.58 8.3 20.58 18.53v160.63c0 10.23-9.24 18.53-20.58 18.53-11.35 0-20.58-8.3-20.58-18.53V245.66z"})],-1))),$={key:0,class:"textarea__chat-mass-del-count"},K=["disabled"],F=["disabled"];var Q=(0,s.aZ)({__name:"ChatTextareaComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=(0,X.t)(),c=r(),o=(0,i.iH)(!0);function d(e){if("edit"!==c.editActionsWithMessage.action){if(""!==c.textarea.trim())if(e.ctrlKey||"click"==e.type){const e=V(),s=c.replyActionsWithMessage.replyMessage||"",n=c.textarea,i=new FormData;i.append("uuid",e),i.append("to",t.routeId||1),i.append("from",t.authStoreUserId),i.append("replyMessage",s),i.append("message",n),u.Z.post("/api/chat",i).then((e=>console.log(e)));const l={uuid:e,message:n||null,replyMessage:s,created_at:(new Date).toISOString(),new:1,created_at_for_humans:"sending",sender:{id:a.user.id,name:a.user.username,admin:a.user.isAdmin?1:0},files:[],images:[]};c.addMessage(l),c.textarea=""}else{let t=e.target.selectionStart;e.target.setRangeText("\n",t,t,"end"),c.textarea=e.target.value}}else g()}function g(){""!==c.textarea.trim()&&(u.Z.patch(`/api/chat/${c.editActionsWithMessage.uuid}`,{message:c.textarea}),c.editMessage(c.textarea)),c.textarea=""}function p(e){let t=c.textarea,a=e.target.selectionStart,s=t.slice(0,a),n=t.slice(a);c.textarea=`${s}\t${n}`,e.target.value=c.textarea,e.target.selectionEnd=e.target.selectionStart=a+1}return(0,s.YP)((()=>c.editActionsWithMessage.uuid),(()=>{"edit"===c.editActionsWithMessage.action?c.textarea=c.selectedMessage.text:c.textarea=""})),(0,s.YP)((()=>c.textarea),(()=>""==c.textarea.trim()?o.value=!0:o.value=!1)),(e,t)=>((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",{class:"textarea__chat-mass-del-btn",onClick:t[0]||(t[0]=e=>(0,i.SU)(c).openModal())},[R,"massDelete"===(0,i.SU)(c).massDeleteMessage.action?((0,s.wg)(),(0,s.iD)("p",$,[(0,s._)("b",null,(0,n.zw)((0,i.SU)(c).massDeleteMessage.uuid?.length),1)])):(0,s.kq)("",!0)]),(0,s.wy)((0,s._)("textarea",{onKeyup:t[1]||(t[1]=(0,l.D2)((0,l.iM)((e=>d(e)),["ctrl"]),["enter"])),onKeydown:t[2]||(t[2]=(0,l.D2)((0,l.iM)((e=>p(e)),["exact","prevent"]),["tab"])),"onUpdate:modelValue":t[3]||(t[3]=e=>(0,i.SU)(c).textarea=e),class:"textarea__chat"},null,544),[[l.nr,(0,i.SU)(c).textarea]]),"edit"===(0,i.SU)(c).editActionsWithMessage.action?((0,s.wg)(),(0,s.iD)("button",{key:0,class:(0,n.C_)(["textarea__chat-edit-btn",{inputDisable:!0===o.value}]),disabled:o.value,onClick:g},null,10,K)):((0,s.wg)(),(0,s.iD)("button",{key:1,class:(0,n.C_)(["textarea__chat-send-btn",{inputDisable:!0===o.value}]),onClick:t[4]||(t[4]=e=>d(e)),disabled:o.value}," Отправить ",10,F))]))}});const B=(0,v.Z)(Q,[["__scopeId","data-v-8cbcddda"]]);var G=B,J=a(7955);const ee=e=>((0,s.dD)("data-v-49df526d"),e=e(),(0,s.Cn)(),e),te={class:"chat-wrapper"},ae=ee((()=>(0,s._)("p",{class:"textarea__chat-edit-title"},"Редактировать",-1))),se={class:"textarea__chat-edit-text"},ne=ee((()=>(0,s._)("p",{class:"textarea__chat-reply-title"},"Ответить на сообщение",-1))),ie={class:"textarea__chat-reply-text"};var le=(0,s.aZ)({__name:"ChatComponent",setup(e){const t=(0,o.yj)(),a=(0,X.t)(),u=(0,J.d)(),c=r();function d(e){return e.length>23?e.slice(0,25)+"...":e}return(e,o)=>((0,s.wg)(),(0,s.iD)("section",te,[(0,s.wy)((0,s._)("div",{class:"chat-name"},(0,n.zw)((0,i.SU)(t).query.name),513),[[l.F8,!(0,i.SU)(u).adminSidebar.isOpen]]),(0,s.Wm)(Z,{routeId:+(0,i.SU)(t).params.id,authStoreUserId:(0,i.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"]),(0,s._)("div",{class:(0,n.C_)("textarea__chat-edit-preview"+("edit"===(0,i.SU)(c).editActionsWithMessage.action?"--active":""))},[ae,(0,s._)("p",se,(0,n.zw)(d((0,i.SU)(c).editActionsWithMessage.initialText)),1),(0,s._)("div",{onClick:o[0]||(o[0]=function(){(0,i.SU)(c).resetEditingMessage()}),class:"close-cross close-edit-info"})],2),(0,s._)("div",{class:(0,n.C_)("textarea__chat-reply-preview"+("reply"===(0,i.SU)(c).replyActionsWithMessage.action?"--active":""))},[ne,(0,s._)("p",ie,(0,n.zw)(d((0,i.SU)(c).replyActionsWithMessage.replyMessage)),1),(0,s._)("div",{onClick:o[1]||(o[1]=function(){(0,i.SU)(c).resetReplyMessage()}),class:"close-cross close-reply-info"})],2),(0,s.Wm)(G,{routeId:+(0,i.SU)(t).params.id,authStoreUserId:(0,i.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"])]))}});const ue=(0,v.Z)(le,[["__scopeId","data-v-49df526d"]]);var ce=ue}}]);
//# sourceMappingURL=500.1e56061a.js.map