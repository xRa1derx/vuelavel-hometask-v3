"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[73],{4999:function(e,t,a){a.d(t,{V:function(){return n}});const n={beforeMount:function(e,t){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||t.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}},7955:function(e,t,a){a.d(t,{d:function(){return i}});var n=a(1020),s=a(4870);const i=(0,n.Q_)("adminStore",(()=>{const e=(0,s.iH)({isOpen:!1});return{adminSidebar:e}}))},5073:function(e,t,a){a.r(t),a.d(t,{default:function(){return ue}});var n=a(3396),s=a(7139),i=a(4870),u=a(9242),l=(a(7658),a(4161)),c=a(1020),o=a(2483);const d=(0,c.Q_)("chatStore",(()=>{const e=(0,i.iH)(),t=(0,i.iH)(!1),a=(0,i.iH)({text:"",uuid:""}),s=(0,i.iH)({uuid:[],action:null,initialText:null}),u=(0,i.iH)({action:null,uuid:[]}),c=(0,o.yj)(),d=(e=null,a=null)=>{t.value=!0,"delete"===e&&(u.value.action="delete",y(e,a))},r=()=>{"delete"===u.value.action&&y(),t.value=!1},v=()=>t.value,m=async(t,a)=>{await l.Z.get(`/api/chat/${t||a}`).then((t=>{e.value=t.data}))},g=()=>e.value,p=t=>{e.value?.unshift(t),M()},h=(t,a)=>{e.value?.filter((e=>{e.uuid===t&&(e.message=a)})),M(),w()},_=()=>{u.value.uuid.forEach((t=>{l.Z.delete(`/api/chat/${t}`).then((t=>{e.value=e.value?.filter((e=>e.uuid!=t.data))})),y()})),r()},f=(e,t)=>{a.value.text=e,a.value.uuid=t},y=(e=null,t=null)=>{null===t?M():"massDelete"===e?(u.value.action="massDelete",u.value.uuid.includes(t)?u.value.uuid.splice(u.value.uuid.indexOf(t),1):u.value.uuid.push(t)):"delete"===e?(u.value.uuid=[],u.value.uuid.push(t)):"edit"===e&&(s.value.uuid=[],s.value.initialText=a.value.text,s.value.uuid.push(t),s.value.action="edit")},M=()=>{const e=document.querySelectorAll(".chat__message-content");[...e].forEach((e=>{e.classList.contains("selected")&&e.classList.remove("selected")})),u.value={uuid:[],action:null}},w=()=>{s.value={initialText:null,action:null,uuid:[]}};return(0,n.YP)((()=>u),(()=>{0===u.value.uuid.length&&"massDelete"===u.value.action&&(u.value.action=null);const e=document.querySelector(".textarea__chat-mass-del-btn");e&&("massDelete"===u.value.action?(e.style.width="40px",e.style.marginLeft="5px"):(e.style.width="0px",e.style.marginLeft="0px"))}),{deep:!0}),(0,n.YP)(c,(()=>{M(),w()})),{getChatData:g,getChat:m,addMessage:p,deleteMessage:_,setMessageAction:y,getModalState:v,closeModal:r,openModal:d,setMessage:f,editMessage:h,resetEditingMessage:w,message:a,editActionsWithMessage:s,deleteActionsWithMessage:u}})),r={class:"chat-message-text"};var v=(0,n.aZ)({__name:"ChatMessageComponent",props:{message:{type:Object},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){const a=e,l=(0,i.iH)(),c=d();function o(e){c.setMessageAction("massDelete",e),l.value.classList.toggle("selected")}function v(e,n){c.setMessage(a.message.message,a.message.uuid),t("contextMenu",e,n)}return(t,i)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__message-content",ref_key:"message",ref:l,onClick:i[1]||(i[1]=e=>o(a.message?.uuid))},[(0,n._)("div",{onClick:i[0]||(i[0]=(0,u.iM)((e=>v(e,a.message?.uuid)),["stop"])),class:(0,s.C_)(["chat__message",[e.authStoreUserId===a.message?.sender.id?"sender":"receiver"]])},[(0,n._)("div",r,(0,s.zw)(a.message?.message),1)],2)],512))}}),m=a(89);const g=(0,m.Z)(v,[["__scopeId","data-v-81e6a662"]]);var p=g;const h={class:"chat__message-day"},_={class:"chat__message-container"};var f=(0,n.aZ)({__name:"ChatDayComponent",props:{messages:{type:Object},date:{type:String},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){function a(e,a){t("contextMenu",e,a)}return(t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",h,(0,s.zw)(e.date),1),(0,n._)("div",_,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.messages,(t=>((0,n.wg)(),(0,n.j4)(p,{key:t.id,onContextMenu:a,message:t,authStoreUserId:e.authStoreUserId},null,8,["message","authStoreUserId"])))),128))])],64))}});const y=(0,m.Z)(f,[["__scopeId","data-v-021037df"]]);var M=y;const w=e=>((0,n.dD)("data-v-1982e040"),e=e(),(0,n.Cn)(),e),x=w((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Добавить файлы",-1))),S=w((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Ответить",-1)));var b=(0,n.aZ)({__name:"ChatContextMenu",props:["clientX","clientY"],emits:["modal","close-context-menu"],setup(e,{emit:t}){const a=d();function i(){a.setMessageAction("edit",a.message.uuid)}return(t,a)=>((0,n.wg)(),(0,n.iD)("div",{onClick:a[2]||(a[2]=e=>t.$emit("close-context-menu")),class:"chat__context-menu",style:(0,s.j5)({left:e.clientX+"px",top:e.clientY+"px"})},[x,S,(0,n._)("button",{onClick:a[0]||(a[0]=e=>i()),class:"chat-context-menu-btn"},"Редактировать"),(0,n._)("button",{class:"chat-context-menu-btn",onClick:a[1]||(a[1]=e=>t.$emit("modal"))},"Удалить")],4))}});const U=(0,m.Z)(b,[["__scopeId","data-v-1982e040"]]);var C=U,I=a(1005),k=a(4999);const D={class:"modal__text-delete"},A={class:"modal__del-buttons"};var H=(0,n.aZ)({__name:"ChatListComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=d(),l=(0,i.iH)({isActive:!1,uuid:null}),c=(0,i.iH)(0),o=(0,i.iH)(0),r=(0,i.iH)();function v(){a.openModal("delete",l.value.uuid)}function m(e,t){!1===l.value.isActive?(p(e),l.value.isActive=!l.value.isActive):p(e),l.value.uuid=t}function g(){l.value.uuid=null,l.value.isActive=!l.value.isActive}function p(e){let t=document.documentElement.clientWidth/2,a=document.documentElement.clientHeight/2;const n=document.querySelector(".admin-page__sidebar").clientWidth;let s=window.innerWidth-(r.value.clientWidth+n);t<e.pageX?c.value=Math.floor(e.clientX-(s/2+n)-130):c.value=Math.floor(e.clientX-(s/2+n)+10),a<e.clientY?o.value=e.clientY+r.value.scrollTop-280:o.value=e.clientY+r.value.scrollTop-120}function h(e){let t=e.created_at.slice(0,16).replace("T"," "),a=t.split(/[- :]/),n=new Date(Date.UTC(a[0],a[1]-1,a[2],a[3],a[4]));return n}(0,n.bv)((()=>a.getChat(t.routeId,t.authStoreUserId)));const _=(0,n.Fl)((()=>{const e=a.getChatData()?.reduce(((e,t)=>{const a=h(t).toLocaleString().slice(0,10);return e[a]=e[a]||[],e[a].push(t),e}),{});return e}));return(t,d)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat",ref_key:"chatBlock",ref:r},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(_.value,((t,a)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__messages",key:t[0].id},[(0,n.Wm)(M,{messages:t,date:a,authStoreUserId:e.authStoreUserId,onContextMenu:m},null,8,["messages","date","authStoreUserId"])])))),128)),l.value.isActive?(0,n.wy)(((0,n.wg)(),(0,n.j4)(C,{key:0,clientX:c.value,clientY:o.value,onCloseContextMenu:g,onModal:d[0]||(d[0]=e=>v())},null,8,["clientX","clientY"])),[[(0,i.SU)(k.V),g]]):(0,n.kq)("",!0),(0,n.Wm)(u.uT,{name:"opacity"},{default:(0,n.w5)((()=>[(0,i.SU)(a).getModalState()?((0,n.wg)(),(0,n.j4)(I.Z,{key:0,onCloseModal:d[3]||(d[3]=e=>(0,i.SU)(a).closeModal())},{header:(0,n.w5)((()=>[(0,n._)("p",D,"Вы действительно хотите удалить "+(0,s.zw)((0,i.SU)(a).deleteActionsWithMessage.uuid.length>1?"эти сообщения":"это сообщение")+"?",1)])),body:(0,n.w5)((()=>[(0,n._)("div",A,[(0,n._)("button",{class:"btn",onClick:d[1]||(d[1]=e=>(0,i.SU)(a).deleteMessage())},"Да"),(0,n._)("button",{class:"btn",onClick:d[2]||(d[2]=e=>(0,i.SU)(a).closeModal())},"Нет")])])),_:1})):(0,n.kq)("",!0)])),_:1})],512))}});const W=(0,m.Z)(H,[["__scopeId","data-v-13f4c2f6"]]);var Z=W;const L="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var T={randomUUID:L};a(1439),a(7585),a(5315);let Y;const z=new Uint8Array(16);function E(){if(!Y&&(Y="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y(z)}const q=[];for(let le=0;le<256;++le)q.push((le+256).toString(16).slice(1));function j(e,t=0){return q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]}function O(e,t,a){if(T.randomUUID&&!t&&!e)return T.randomUUID();e=e||{};const n=e.random||(e.rng||E)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=n[e];return t}return j(n)}var V=O,X=a(7183);const $=e=>((0,n.dD)("data-v-2624ac76"),e=e(),(0,n.Cn)(),e),N={class:"textarea-wrapper"},P=$((()=>(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg","clip-rule":"evenodd","fill-rule":"evenodd","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision","image-rendering":"optimizeQuality",viewBox:"0 0 456 511.82"},[(0,n._)("path",{d:"M48.42 140.13h361.99c17.36 0 29.82 9.78 28.08 28.17l-30.73 317.1c-1.23 13.36-8.99 26.42-25.3 26.42H76.34c-13.63-.73-23.74-9.75-25.09-24.14L20.79 168.99c-1.74-18.38 9.75-28.86 27.63-28.86zM24.49 38.15h136.47V28.1c0-15.94 10.2-28.1 27.02-28.1h81.28c17.3 0 27.65 11.77 27.65 28.01v10.14h138.66c.57 0 1.11.07 1.68.13 10.23.93 18.15 9.02 18.69 19.22.03.79.06 1.39.06 2.17v42.76c0 5.99-4.73 10.89-10.62 11.19-.54 0-1.09.03-1.63.03H11.22c-5.92 0-10.77-4.6-11.19-10.38 0-.72-.03-1.47-.03-2.23v-39.5c0-10.93 4.21-20.71 16.82-23.02 2.53-.45 5.09-.37 7.67-.37zm83.78 208.38c-.51-10.17 8.21-18.83 19.53-19.31 11.31-.49 20.94 7.4 21.45 17.57l8.7 160.62c.51 10.18-8.22 18.84-19.53 19.32-11.32.48-20.94-7.4-21.46-17.57l-8.69-160.63zm201.7-1.74c.51-10.17 10.14-18.06 21.45-17.57 11.32.48 20.04 9.14 19.53 19.31l-8.66 160.63c-.52 10.17-10.14 18.05-21.46 17.57-11.31-.48-20.04-9.14-19.53-19.32l8.67-160.62zm-102.94.87c0-10.23 9.23-18.53 20.58-18.53 11.34 0 20.58 8.3 20.58 18.53v160.63c0 10.23-9.24 18.53-20.58 18.53-11.35 0-20.58-8.3-20.58-18.53V245.66z"})],-1))),K=[P],F=$((()=>(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64","enable-background":"new 0 0 64 64"},[(0,n._)("path",{d:"M32,2C15.431,2,2,15.432,2,32c0,16.568,13.432,30,30,30c16.568,0,30-13.432,30-30C62,15.432,48.568,2,32,2z M25.025,50\n\tl-0.02-0.02L24.988,50L11,35.6l7.029-7.164l6.977,7.184l21-21.619L53,21.199L25.025,50z"})],-1))),R=[F],B=["disabled"],Q=$((()=>(0,n._)("p",{class:"textarea__chat-edit-title"},"Редактировать",-1))),G={class:"textarea__chat-edit-text"};var J=(0,n.aZ)({__name:"ChatTextareaComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=(0,X.t)(),c=d(),o=(0,i.iH)(""),r=(0,i.iH)(!0),v=(0,n.Fl)((()=>{if(c.editActionsWithMessage.initialText)return c.editActionsWithMessage.initialText.length>23?c.editActionsWithMessage.initialText.slice(0,25)+"...":c.editActionsWithMessage.initialText}));function m(e){if(""!==o.value.trim())if(e.ctrlKey||"click"==e.type){const e=V(),n="",s=o.value,i=new FormData;i.append("uuid",e),i.append("to",t.routeId||1),i.append("from",t.authStoreUserId),i.append("replyMessage",n),i.append("message",s),l.Z.post("/api/chat",i).then((e=>console.log(e)));const u={uuid:e,message:s||null,replyMessage:n,created_at:(new Date).toISOString(),new:1,created_at_for_humans:"sending",sender:{id:a.user.id,name:a.user.username,admin:a.user.isAdmin?1:0},files:[],images:[]};c.addMessage(u),o.value=""}else{let t=e.target.selectionStart;e.target.setRangeText("\n",t,t,"end"),o.value=e.target.value}}function g(){""!==o.value.trim()&&(l.Z.patch(`/api/chat/${c.message.uuid}`,{message:o.value}),c.editMessage(c.message.uuid,o.value)),o.value=""}function p(){c.resetEditingMessage(),o.value=""}function h(e){let t=o.value,a=e.target.selectionStart,n=t.slice(0,a),s=t.slice(a);o.value=`${n}\t${s}`,e.target.value=o.value,e.target.selectionEnd=e.target.selectionStart=a+1}return(0,n.YP)((()=>c.editActionsWithMessage.uuid),(()=>{"edit"===c.editActionsWithMessage.action&&(o.value=c.message.text)})),(0,n.YP)((()=>o.value),(()=>""==o.value.trim()?r.value=!0:r.value=!1)),(e,t)=>((0,n.wg)(),(0,n.iD)("div",N,[(0,n._)("div",{class:"textarea__chat-mass-del-btn",onClick:t[0]||(t[0]=e=>(0,i.SU)(c).openModal())},K),(0,n.wy)((0,n._)("textarea",{onKeyup:t[1]||(t[1]=(0,u.D2)((0,u.iM)((e=>m(e)),["ctrl"]),["enter"])),onKeydown:t[2]||(t[2]=(0,u.D2)((0,u.iM)((e=>h(e)),["exact","prevent"]),["tab"])),"onUpdate:modelValue":t[3]||(t[3]=e=>o.value=e),class:"textarea__chat"},null,544),[[u.nr,o.value]]),"edit"===(0,i.SU)(c).editActionsWithMessage.action?((0,n.wg)(),(0,n.iD)("button",{key:0,class:"textarea__chat-edit-btn",onClick:g},R)):((0,n.wg)(),(0,n.iD)("button",{key:1,class:(0,s.C_)(["textarea__chat-send-btn",{inputDisable:!0===r.value}]),onClick:m,disabled:r.value}," Отправить ",10,B)),(0,n._)("div",{class:(0,s.C_)("textarea__chat-edit-preview"+("edit"===(0,i.SU)(c).editActionsWithMessage.action?"--active":""))},[Q,(0,n._)("p",G,(0,s.zw)(v.value),1),(0,n._)("div",{onClick:t[4]||(t[4]=e=>p()),class:"close-cross close-edit-info"})],2)]))}});const ee=(0,m.Z)(J,[["__scopeId","data-v-2624ac76"]]);var te=ee,ae=a(7955);const ne={class:"chat-wrapper"};var se=(0,n.aZ)({__name:"ChatComponent",setup(e){const t=(0,o.yj)(),a=(0,X.t)(),l=(0,ae.d)();return(e,c)=>((0,n.wg)(),(0,n.iD)("section",ne,[(0,n.wy)((0,n._)("div",{class:"chat-name"},(0,s.zw)((0,i.SU)(t).query.name),513),[[u.F8,!(0,i.SU)(l).adminSidebar.isOpen]]),(0,n.Wm)(Z,{routeId:+(0,i.SU)(t).params.id,authStoreUserId:(0,i.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"]),(0,n.Wm)(te,{routeId:+(0,i.SU)(t).params.id,authStoreUserId:(0,i.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"])]))}});const ie=(0,m.Z)(se,[["__scopeId","data-v-099b4c99"]]);var ue=ie}}]);
//# sourceMappingURL=73.fe44e63a.js.map