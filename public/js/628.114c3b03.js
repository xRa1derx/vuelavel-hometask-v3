"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[628],{4999:function(e,t,a){a.d(t,{V:function(){return n}});const n={beforeMount:function(e,t){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||t.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}},7955:function(e,t,a){a.d(t,{d:function(){return u}});var n=a(1020),s=a(4870);const u=(0,n.Q_)("adminStore",(()=>{const e=(0,s.iH)({isOpen:!1});return{adminSidebar:e}}))},4628:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});var n=a(3396),s=a(7139),u=a(4870),o=a(9242),l=(a(7658),a(4161)),c=a(1020),i=a(2483);const r=(0,c.Q_)("chatStore",(()=>{const e=(0,u.iH)(),t=(0,u.iH)(!1),a=(0,u.iH)({uuid:[],action:null}),s=(0,i.yj)(),o=(e=null,a=null)=>{t.value=!0,"delete"===e&&h(e,a)},c=()=>{"delete"===a.value.action&&h(),t.value=!1},r=()=>t.value,d=async(t,a)=>{await l.Z.get(`/api/chat/${t||a}`).then((t=>{e.value=t.data}))},v=()=>e.value,m=t=>{e.value?.unshift(t),_()},p=()=>{g().uuid.forEach((t=>{l.Z.delete(`/api/chat/${t}`).then((t=>{e.value=e.value?.filter((e=>e.uuid!=t.data))})),h()})),c()},g=()=>a.value,h=(e=null,t=null)=>{null===t?_():"massDelete"===e?a.value.uuid.includes(t)?a.value.uuid.splice(a.value.uuid.indexOf(t),1):a.value.uuid.push(t):(a.value.uuid=[],a.value.uuid.push(t)),a.value.action=e},_=()=>{const e=document.querySelectorAll(".chat__message-content");[...e].forEach((e=>{e.classList.contains("selected")&&e.classList.remove("selected")})),a.value.action=null,a.value.uuid=[]};return(0,n.YP)((()=>a),(()=>{0===a.value.uuid.length&&(a.value.action=null);const e=document.querySelector(".textarea__chat-mass-del-btn");e&&("massDelete"===a.value.action?(e.style.width="40px",e.style.marginRight="5px"):(e.style.width="0px",e.style.marginRight="0px"))}),{deep:!0}),(0,n.YP)(s,(()=>{a.value.action=null,a.value.uuid=[]})),{getChatData:v,getChat:d,addMessage:m,deleteMessage:p,setMessageAction:h,getMessageAction:g,getModalState:r,closeModal:c,openModal:o,actionWithMessage:a}})),d={class:"chat-message-text"};var v=(0,n.aZ)({__name:"ChatMessageComponent",props:{message:{type:Object},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){const a=e,l=(0,u.iH)(),c=r();function i(e){c.setMessageAction("massDelete",e),l.value.classList.toggle("selected")}function v(e,a){t("contextMenu",e,a)}return(t,u)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__message-content",ref_key:"message",ref:l,onClick:u[1]||(u[1]=e=>i(a.message?.uuid))},[(0,n._)("div",{onClick:u[0]||(u[0]=(0,o.iM)((e=>v(e,a.message?.uuid)),["stop"])),class:(0,s.C_)(["chat__message",[e.authStoreUserId===a.message?.sender.id?"sender":"receiver"]])},[(0,n._)("div",d,(0,s.zw)(a.message?.message),1)],2)],512))}}),m=a(89);const p=(0,m.Z)(v,[["__scopeId","data-v-60f7efd8"]]);var g=p;const h={class:"chat__message-day"},_={class:"chat__message-container"};var f=(0,n.aZ)({__name:"ChatDayComponent",props:{messages:{type:Object},date:{type:String},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){function a(e,a){t("contextMenu",e,a)}return(t,u)=>((0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",h,(0,s.zw)(e.date),1),(0,n._)("div",_,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.messages,(t=>((0,n.wg)(),(0,n.j4)(g,{key:t.id,onContextMenu:a,message:t,authStoreUserId:e.authStoreUserId},null,8,["message","authStoreUserId"])))),128))])],64))}});const y=(0,m.Z)(f,[["__scopeId","data-v-021037df"]]);var S=y;const U=e=>((0,n.dD)("data-v-38607a0b"),e=e(),(0,n.Cn)(),e),w=U((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Добавить файлы",-1))),b=U((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Ответить",-1))),M=U((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Редактировать",-1)));var C=(0,n.aZ)({__name:"ChatContextMenu",props:["clientX","clientY"],emits:["modal"],setup(e,{emit:t}){return(t,a)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__context-menu",style:(0,s.j5)({left:e.clientX+"px",top:e.clientY+"px"})},[w,b,M,(0,n._)("button",{class:"chat-context-menu-btn",onClick:a[0]||(a[0]=e=>t.$emit("modal"))},"Удалить")],4))}});const I=(0,m.Z)(C,[["__scopeId","data-v-38607a0b"]]);var x=I,D=a(3901),k=a(4999);const A=e=>((0,n.dD)("data-v-26fd8400"),e=e(),(0,n.Cn)(),e),H=A((()=>(0,n._)("p",{class:"modal__text-delete"},"Вы действительно хотите удалить это сообщение?",-1))),Z={class:"modal__del-buttons"};var q=(0,n.aZ)({__name:"ChatListComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=r(),s=(0,u.iH)({isActive:!1,uuid:null}),l=(0,u.iH)(0),c=(0,u.iH)(0),i=(0,u.iH)();function d(){a.openModal("delete",s.value.uuid),m()}function v(e,t){s.value.uuid=null,a.setMessageAction(s.value.uuid),!1===s.value.isActive?(p(e),s.value.isActive=!s.value.isActive):p(e),s.value.uuid=t}function m(){s.value.uuid=null,s.value.isActive=!s.value.isActive}function p(e){let t=document.documentElement.clientWidth/2,a=document.documentElement.clientHeight/2;const n=document.querySelector(".admin-page__sidebar").clientWidth;let s=window.innerWidth-(i.value.clientWidth+n);t<e.pageX?l.value=Math.floor(e.clientX-(s/2+n)-130):l.value=Math.floor(e.clientX-(s/2+n)+10),a<e.clientY?c.value=e.clientY+i.value.scrollTop-280:c.value=e.clientY+i.value.scrollTop-120}function g(e){let t=e.created_at.slice(0,16).replace("T"," "),a=t.split(/[- :]/),n=new Date(Date.UTC(a[0],a[1]-1,a[2],a[3],a[4]));return n}(0,n.bv)((()=>a.getChat(t.routeId,t.authStoreUserId)));const h=(0,n.Fl)((()=>{const e=a.getChatData()?.reduce(((e,t)=>{const a=g(t).toLocaleString().slice(0,10);return e[a]=e[a]||[],e[a].push(t),e}),{});return e}));return(t,r)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat",ref_key:"chatBlock",ref:i},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(h.value,((t,a)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__messages",key:t[0].id},[(0,n.Wm)(S,{messages:t,date:a,authStoreUserId:e.authStoreUserId,onContextMenu:v},null,8,["messages","date","authStoreUserId"])])))),128)),s.value.isActive?(0,n.wy)(((0,n.wg)(),(0,n.j4)(x,{key:0,clientX:l.value,clientY:c.value,isContextMenu:s.value,onCloseContextMenu:m,onModal:r[0]||(r[0]=e=>d())},null,8,["clientX","clientY","isContextMenu"])),[[(0,u.SU)(k.V),m]]):(0,n.kq)("",!0),(0,n.Wm)(o.uT,{name:"opacity"},{default:(0,n.w5)((()=>[(0,u.SU)(a).getModalState()?((0,n.wg)(),(0,n.j4)(D.Z,{key:0,onCloseModal:r[3]||(r[3]=e=>(0,u.SU)(a).closeModal())},{header:(0,n.w5)((()=>[H])),body:(0,n.w5)((()=>[(0,n._)("div",Z,[(0,n._)("button",{class:"btn",onClick:r[1]||(r[1]=e=>(0,u.SU)(a).deleteMessage(s.value.uuid))},"Да"),(0,n._)("button",{class:"btn",onClick:r[2]||(r[2]=e=>(0,u.SU)(a).closeModal())},"Нет")])])),_:1})):(0,n.kq)("",!0)])),_:1})],512))}});const Y=(0,m.Z)(q,[["__scopeId","data-v-26fd8400"]]);var E=Y;const j="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var z={randomUUID:j};a(1439),a(7585),a(5315);let O;const W=new Uint8Array(16);function L(){if(!O&&(O="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(W)}const V=[];for(let se=0;se<256;++se)V.push((se+256).toString(16).slice(1));function T(e,t=0){return V[e[t+0]]+V[e[t+1]]+V[e[t+2]]+V[e[t+3]]+"-"+V[e[t+4]]+V[e[t+5]]+"-"+V[e[t+6]]+V[e[t+7]]+"-"+V[e[t+8]]+V[e[t+9]]+"-"+V[e[t+10]]+V[e[t+11]]+V[e[t+12]]+V[e[t+13]]+V[e[t+14]]+V[e[t+15]]}function X(e,t,a){if(z.randomUUID&&!t&&!e)return z.randomUUID();e=e||{};const n=e.random||(e.rng||L)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=n[e];return t}return T(n)}var N=X,R=a(7183);const K=e=>((0,n.dD)("data-v-52304483"),e=e(),(0,n.Cn)(),e),$={class:"textarea-wrapper"},P=K((()=>(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg","clip-rule":"evenodd","fill-rule":"evenodd","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision","image-rendering":"optimizeQuality",viewBox:"0 0 456 511.82"},[(0,n._)("path",{d:"M48.42 140.13h361.99c17.36 0 29.82 9.78 28.08 28.17l-30.73 317.1c-1.23 13.36-8.99 26.42-25.3 26.42H76.34c-13.63-.73-23.74-9.75-25.09-24.14L20.79 168.99c-1.74-18.38 9.75-28.86 27.63-28.86zM24.49 38.15h136.47V28.1c0-15.94 10.2-28.1 27.02-28.1h81.28c17.3 0 27.65 11.77 27.65 28.01v10.14h138.66c.57 0 1.11.07 1.68.13 10.23.93 18.15 9.02 18.69 19.22.03.79.06 1.39.06 2.17v42.76c0 5.99-4.73 10.89-10.62 11.19-.54 0-1.09.03-1.63.03H11.22c-5.92 0-10.77-4.6-11.19-10.38 0-.72-.03-1.47-.03-2.23v-39.5c0-10.93 4.21-20.71 16.82-23.02 2.53-.45 5.09-.37 7.67-.37zm83.78 208.38c-.51-10.17 8.21-18.83 19.53-19.31 11.31-.49 20.94 7.4 21.45 17.57l8.7 160.62c.51 10.18-8.22 18.84-19.53 19.32-11.32.48-20.94-7.4-21.46-17.57l-8.69-160.63zm201.7-1.74c.51-10.17 10.14-18.06 21.45-17.57 11.32.48 20.04 9.14 19.53 19.31l-8.66 160.63c-.52 10.17-10.14 18.05-21.46 17.57-11.31-.48-20.04-9.14-19.53-19.32l8.67-160.62zm-102.94.87c0-10.23 9.23-18.53 20.58-18.53 11.34 0 20.58 8.3 20.58 18.53v160.63c0 10.23-9.24 18.53-20.58 18.53-11.35 0-20.58-8.3-20.58-18.53V245.66z"})],-1))),F=[P];var Q=(0,n.aZ)({__name:"ChatTextareaComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,a=(0,u.iH)(""),s=(0,R.t)(),c=r();function i(e){if(""!==a.value.trim())if(e.ctrlKey||"click"==e.type){const e=N(),n="",u=a.value,o=new FormData;o.append("uuid",e),o.append("to",t.routeId||1),o.append("from",t.authStoreUserId),o.append("replyMessage",n),o.append("message",u),l.Z.post("/api/chat",o).then((e=>console.log(e)));const i={uuid:e,message:u||null,replyMessage:n,created_at:(new Date).toISOString(),new:1,created_at_for_humans:"sending",sender:{id:s.user.id,name:s.user.username,admin:s.user.isAdmin?1:0},files:[],images:[]};c.addMessage(i),a.value=""}else{let t=e.target.selectionStart;e.target.setRangeText("\n",t,t,"end"),a.value=e.target.value}}function d(e){let t=a.value,n=e.target.selectionStart,s=t.slice(0,n),u=t.slice(n);a.value=`${s}\t${u}`,e.target.value=a.value,e.target.selectionEnd=e.target.selectionStart=n+1}return(e,t)=>((0,n.wg)(),(0,n.iD)("div",$,[(0,n._)("div",{class:"textarea__chat-mass-del-btn",onClick:t[0]||(t[0]=e=>(0,u.SU)(c).openModal())},F),(0,n.wy)((0,n._)("textarea",{onKeyup:t[1]||(t[1]=(0,o.D2)((0,o.iM)((e=>i(e)),["ctrl"]),["enter"])),onKeydown:t[2]||(t[2]=(0,o.D2)((0,o.iM)((e=>d(e)),["exact","prevent"]),["tab"])),"onUpdate:modelValue":t[3]||(t[3]=e=>a.value=e),class:"textarea__chat"},null,544),[[o.nr,a.value]]),(0,n._)("button",{class:"textarea__chat-send-btn",onClick:i},"Отправить")]))}});const B=(0,m.Z)(Q,[["__scopeId","data-v-52304483"]]);var G=B,J=a(7955);const ee={class:"chat-wrapper"};var te=(0,n.aZ)({__name:"ChatComponent",setup(e){const t=(0,i.yj)(),a=(0,R.t)(),l=(0,J.d)();return(e,c)=>((0,n.wg)(),(0,n.iD)("section",ee,[(0,n.wy)((0,n._)("div",{class:"chat-name"},(0,s.zw)((0,u.SU)(t).query.name),513),[[o.F8,!(0,u.SU)(l).adminSidebar.isOpen]]),(0,n.Wm)(E,{routeId:+(0,u.SU)(t).params.id,authStoreUserId:(0,u.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"]),(0,n.Wm)(G,{routeId:+(0,u.SU)(t).params.id,authStoreUserId:(0,u.SU)(a).getAuthUser().id},null,8,["routeId","authStoreUserId"])]))}});const ae=(0,m.Z)(te,[["__scopeId","data-v-afe94dca"]]);var ne=ae}}]);
//# sourceMappingURL=628.114c3b03.js.map