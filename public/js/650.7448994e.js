"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[650],{4999:function(e,t,n){n.d(t,{V:function(){return a}});const a={beforeMount:function(e,t){e.clickOutsideEvent=function(n){e===n.target||e.contains(n.target)||t.value(n)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}},7955:function(e,t,n){n.d(t,{d:function(){return o}});var a=n(1020),r=n(4870);const o=(0,a.Q_)("adminStore",(()=>{const e=(0,r.iH)({isOpen:!1});return{adminSidebar:e}}))},2650:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var a=n(3396),r=n(7139),o=n(4870),c=n(9242),s=(n(7658),n(4161));const u={class:"chat__message-day"},i={class:"chat__message-container"},l=["onClick"],d={class:"chat-message-text"};var p=(0,a.aZ)({__name:"ChatMessageComponent",props:{messages:{type:Object},date:{type:String},authStoreUserId:{type:Number,required:!0}},emits:["contextMenu"],setup(e,{emit:t}){function n(e,n){t("contextMenu",e,n)}return(t,o)=>((0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",u,(0,r.zw)(e.date),1),(0,a._)("div",i,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.messages,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.id,onClick:(0,c.iM)((e=>n(e,t.id)),["stop"]),class:(0,r.C_)(["chat__message",[e.authStoreUserId===t.sender.id?"sender":"receiver"]])},[(0,a._)("div",d,(0,r.zw)(t.message),1)],10,l)))),128))])],64))}}),v=n(89);const m=(0,v.Z)(p,[["__scopeId","data-v-22d594f2"]]);var h=m;const g=e=>((0,a.dD)("data-v-3befa1d4"),e=e(),(0,a.Cn)(),e),_=g((()=>(0,a._)("button",{class:"chat-context-menu-btn"},"Добавить файлы",-1))),f=g((()=>(0,a._)("button",{class:"chat-context-menu-btn"},"Ответить",-1))),y=g((()=>(0,a._)("button",{class:"chat-context-menu-btn"},"Редактировать",-1))),U=g((()=>(0,a._)("button",{class:"chat-context-menu-btn"},"Удалить",-1))),b=[_,f,y,U];var I=(0,a.aZ)({__name:"ChatContextMenu",props:["clientX","clientY"],setup(e){return(t,n)=>((0,a.wg)(),(0,a.iD)("div",{class:"chat__context-menu",style:(0,r.j5)({left:e.clientX+"px",top:e.clientY+"px"})},b,4))}});const S=(0,v.Z)(I,[["__scopeId","data-v-3befa1d4"]]);var w=S,D=n(4999),k=(0,a.aZ)({__name:"ChatMessagesComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e;function n(){c.value.isActive&&(c.value.isActive=!c.value.isActive)}const r=(0,o.iH)(),c=(0,o.iH)({isActive:!1,id:null}),u=(0,o.iH)(0),i=(0,o.iH)(0),l=(0,o.iH)();function d(){s.Z.get(`/api/chat/${t.routeId||t.authStoreUserId}`).then((e=>{console.log(e.data),r.value=e.data}))}function p(e,t){!1===c.value.isActive?(v(e),c.value.isActive=!c.value.isActive):v(e),c.value.id=t}function v(e){let t=document.documentElement.clientWidth/2,n=document.documentElement.clientHeight/2;const a=document.querySelector(".admin-page__sidebar").clientWidth;let r=window.innerWidth-(l.value.clientWidth+a);t<e.pageX?u.value=Math.floor(e.clientX-(r/2+a)-130):u.value=Math.floor(e.clientX-(r/2+a)+10),n<e.clientY?i.value=e.clientY+l.value.scrollTop-280:i.value=e.clientY+l.value.scrollTop-120}function m(e){let t=e.created_at.slice(0,16).replace("T"," "),n=t.split(/[- :]/),a=new Date(Date.UTC(n[0],n[1]-1,n[2],n[3],n[4]));return a}(0,a.bv)((()=>d()));const g=(0,a.Fl)((()=>{const e=r.value?.reduce(((e,t)=>{const n=m(t).toLocaleString().slice(0,10);return e[n]=e[n]||[],e[n].push(t),e}),{});return e}));return(t,r)=>((0,a.wg)(),(0,a.iD)("div",{class:"chat",ref_key:"chatBlock",ref:l},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(g.value,((t,n)=>((0,a.wg)(),(0,a.iD)("div",{class:"chat__messages",key:t[0].id},[(0,a.Wm)(h,{messages:t,date:n,authStoreUserId:e.authStoreUserId,onContextMenu:p},null,8,["messages","date","authStoreUserId"])])))),128)),c.value.isActive?(0,a.wy)(((0,a.wg)(),(0,a.j4)(w,{key:0,clientX:u.value,clientY:i.value},null,8,["clientX","clientY"])),[[(0,o.SU)(D.V),n]]):(0,a.kq)("",!0)],512))}});const x=(0,v.Z)(k,[["__scopeId","data-v-edb36634"]]);var C=x;const M="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Z={randomUUID:M};n(1439),n(7585),n(5315);let A;const H=new Uint8Array(16);function Y(){if(!A&&(A="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!A))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(H)}const E=[];for(let B=0;B<256;++B)E.push((B+256).toString(16).slice(1));function q(e,t=0){return E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]}function W(e,t,n){if(Z.randomUUID&&!t&&!e)return Z.randomUUID();e=e||{};const a=e.random||(e.rng||Y)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=a[e];return t}return q(a)}var X=W;const O={class:"textarea-wrapper"};var T=(0,a.aZ)({__name:"ChatTextareaComponent",props:{routeId:{type:Number,required:!0},authStoreUserId:{type:Number,required:!0}},setup(e){const t=e,n=(0,o.iH)("");function r(e){if(""!==n.value.trim())if(e.ctrlKey||"click"==e.type){const e=X(),a=n.value,r=new FormData;r.append("uuid",e),r.append("to",t.routeId||1),r.append("from",t.authStoreUserId),r.append("message",a),s.Z.post("/api/chat",r).then((e=>console.log(e)))}else{let t=e.target.selectionStart;e.target.setRangeText("\n",t,t,"end"),n.value=e.target.value}}function u(e){let t=n.value,a=e.target.selectionStart,r=t.slice(0,a),o=t.slice(a);n.value=`${r}\t${o}`,e.target.value=n.value,e.target.selectionEnd=e.target.selectionStart=a+1}return(e,t)=>((0,a.wg)(),(0,a.iD)("div",O,[(0,a.wy)((0,a._)("textarea",{onKeyup:t[0]||(t[0]=(0,c.D2)((0,c.iM)((e=>r(e)),["ctrl"]),["enter"])),onKeydown:t[1]||(t[1]=(0,c.D2)((0,c.iM)((e=>u(e)),["exact","prevent"]),["tab"])),"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),class:"textarea__chat"},null,544),[[c.nr,n.value]]),(0,a._)("button",{class:"textarea__chat-send-btn",onClick:r},"Отправить")]))}});const V=(0,v.Z)(T,[["__scopeId","data-v-7f69bd68"]]);var j=V,K=n(2483),N=n(7183),R=n(7955);const z={class:"chat-wrapper"};var F=(0,a.aZ)({__name:"ChatComponent",setup(e){const t=(0,K.yj)(),n=(0,N.t)(),s=(0,R.d)();return(e,u)=>((0,a.wg)(),(0,a.iD)("section",z,[(0,a.wy)((0,a._)("div",{class:"chat-name"},(0,r.zw)((0,o.SU)(t).query.name),513),[[c.F8,!(0,o.SU)(s).adminSidebar.isOpen]]),(0,a.Wm)(C,{routeId:+(0,o.SU)(t).params.id,authStoreUserId:(0,o.SU)(n).getAuthUser().id},null,8,["routeId","authStoreUserId"]),(0,a.Wm)(j,{routeId:+(0,o.SU)(t).params.id,authStoreUserId:(0,o.SU)(n).getAuthUser().id},null,8,["routeId","authStoreUserId"])]))}});const L=(0,v.Z)(F,[["__scopeId","data-v-a2bc0592"]]);var $=L}}]);
//# sourceMappingURL=650.7448994e.js.map