"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[499],{3013:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(e,t,a){var n,i,s,r=a(3013),l=a(9781),c=a(7854),o=a(614),u=a(111),d=a(2597),g=a(648),p=a(6330),v=a(8880),m=a(8052),h=a(7045),y=a(7976),f=a(9518),_=a(7674),x=a(5112),w=a(9711),M=a(9909),A=M.enforce,C=M.get,k=c.Int8Array,D=k&&k.prototype,b=c.Uint8ClampedArray,U=b&&b.prototype,S=k&&f(k),T=D&&f(D),H=Object.prototype,I=c.TypeError,z=x("toStringTag"),E=w("TYPED_ARRAY_TAG"),W="TypedArrayConstructor",Y=r&&!!_&&"Opera"!==g(c.opera),V=!1,q={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},O={BigInt64Array:8,BigUint64Array:8},R=function(e){if(!u(e))return!1;var t=g(e);return"DataView"===t||d(q,t)||d(O,t)},j=function(e){var t=f(e);if(u(t)){var a=C(t);return a&&d(a,W)?a[W]:j(t)}},B=function(e){if(!u(e))return!1;var t=g(e);return d(q,t)||d(O,t)},Z=function(e){if(B(e))return e;throw I("Target is not a typed array")},L=function(e){if(o(e)&&(!_||y(S,e)))return e;throw I(p(e)+" is not a typed array constructor")},P=function(e,t,a,n){if(l){if(a)for(var i in q){var s=c[i];if(s&&d(s.prototype,e))try{delete s.prototype[e]}catch(r){try{s.prototype[e]=t}catch(o){}}}T[e]&&!a||m(T,e,a?t:Y&&D[e]||t,n)}},$=function(e,t,a){var n,i;if(l){if(_){if(a)for(n in q)if(i=c[n],i&&d(i,e))try{delete i[e]}catch(s){}if(S[e]&&!a)return;try{return m(S,e,a?t:Y&&S[e]||t)}catch(s){}}for(n in q)i=c[n],!i||i[e]&&!a||m(i,e,t)}};for(n in q)i=c[n],s=i&&i.prototype,s?A(s)[W]=i:Y=!1;for(n in O)i=c[n],s=i&&i.prototype,s&&(A(s)[W]=i);if((!Y||!o(S)||S===Function.prototype)&&(S=function(){throw I("Incorrect invocation")},Y))for(n in q)c[n]&&_(c[n],S);if((!Y||!T||T===H)&&(T=S.prototype,Y))for(n in q)c[n]&&_(c[n].prototype,T);if(Y&&f(U)!==T&&_(U,T),l&&!d(T,z))for(n in V=!0,h(T,z,{configurable:!0,get:function(){return u(this)?this[E]:void 0}}),q)c[n]&&v(c[n],E,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:Y,TYPED_ARRAY_TAG:V&&E,aTypedArray:Z,aTypedArrayConstructor:L,exportTypedArrayMethod:P,exportTypedArrayStaticMethod:$,getTypedArrayConstructor:j,isView:R,isTypedArray:B,TypedArray:S,TypedArrayPrototype:T}},7745:function(e,t,a){var n=a(6244);e.exports=function(e,t){var a=0,i=n(t),s=new e(i);while(i>a)s[a]=t[a++];return s}},1843:function(e,t,a){var n=a(6244);e.exports=function(e,t){for(var a=n(e),i=new t(a),s=0;s<a;s++)i[s]=e[a-s-1];return i}},1572:function(e,t,a){var n=a(6244),i=a(9303),s=RangeError;e.exports=function(e,t,a,r){var l=n(e),c=i(a),o=c<0?l+c:c;if(o>=l||o<0)throw s("Incorrect index");for(var u=new t(l),d=0;d<l;d++)u[d]=d===o?r:e[d];return u}},8544:function(e,t,a){var n=a(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4067:function(e,t,a){var n=a(648);e.exports=function(e){var t=n(e);return"BigInt64Array"==t||"BigUint64Array"==t}},9518:function(e,t,a){var n=a(2597),i=a(614),s=a(7908),r=a(6200),l=a(8544),c=r("IE_PROTO"),o=Object,u=o.prototype;e.exports=l?o.getPrototypeOf:function(e){var t=s(e);if(n(t,c))return t[c];var a=t.constructor;return i(a)&&t instanceof a?a.prototype:t instanceof o?u:null}},4599:function(e,t,a){var n=a(7593),i=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw i("Can't convert number to bigint");return BigInt(t)}},1439:function(e,t,a){var n=a(1843),i=a(260),s=i.aTypedArray,r=i.exportTypedArrayMethod,l=i.getTypedArrayConstructor;r("toReversed",(function(){return n(s(this),l(this))}))},7585:function(e,t,a){var n=a(260),i=a(1702),s=a(9662),r=a(7745),l=n.aTypedArray,c=n.getTypedArrayConstructor,o=n.exportTypedArrayMethod,u=i(n.TypedArrayPrototype.sort);o("toSorted",(function(e){void 0!==e&&s(e);var t=l(this),a=r(c(t),t);return u(a,e)}))},5315:function(e,t,a){var n=a(1572),i=a(260),s=a(4067),r=a(9303),l=a(4599),c=i.aTypedArray,o=i.getTypedArrayConstructor,u=i.exportTypedArrayMethod,d=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();u("with",{with:function(e,t){var a=c(this),i=r(e),u=s(a)?l(t):+t;return n(a,o(a),i,u)}}["with"],!d)},4999:function(e,t,a){a.d(t,{V:function(){return n}});const n={beforeMount:function(e,t){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||t.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}},7955:function(e,t,a){a.d(t,{d:function(){return s}});var n=a(1020),i=a(4870);const s=(0,n.Q_)("adminStore",(()=>{const e=(0,i.iH)({isOpen:!0});return{adminSidebar:e}}))},499:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ie}});var n=a(3396),i=a(4870),s=a(7139),r=a(9242),l=(a(7658),a(5209)),c=a(2983),o=a(6265),u=a.n(o),d=a(1020),g=a(2483);const p=(0,d.Q_)("chatStore",(()=>{const e=(0,i.iH)(),t=(0,i.iH)(!1),a=(0,i.iH)(""),s=(0,i.iH)({text:"",uuid:""}),r=(0,i.iH)({replyMessage:"",uuid:"",action:null}),l=(0,i.iH)({uuid:"",action:null,initialText:""}),c=(0,i.iH)({action:null,uuid:null}),o=(0,i.iH)({action:null,uuid:null}),d=(0,g.yj)(),p=(e=null)=>{t.value=!0,"delete"===e&&(c.value.action="delete",M(e,s.value.uuid))},v=()=>{c.value={action:null,uuid:null},t.value=!1},m=()=>t.value,h=async(t,a)=>{await u().get(`/api/chat/${t||a}`).then((t=>{e.value=t.data}))},y=()=>e.value,f=t=>{e.value?.unshift(t),k(),A()},_=t=>{e.value?.filter((e=>{e.uuid===l.value.uuid&&(e.message=t)})),C()},x=()=>{let t=c.value.uuid||o.value.uuid;t?.forEach((t=>{u()["delete"](`/api/chat/${t}`).then((t=>{e.value=e.value?.filter((e=>e.uuid!=t.data))})),t===l.value.uuid&&(console.log("here"),C())})),A(),v()},w=(e,t)=>{s.value.text=e,s.value.uuid=t},M=(e=null,t)=>{"massDelete"===e?(o.value.action="massDelete",o.value?.uuid||(o.value.uuid=[]),o.value.uuid?.includes(t)?o.value.uuid.splice(o.value.uuid.indexOf(t),1):o.value.uuid?.push(t)):"delete"===e?(c.value.uuid=[],c.value.uuid.push(t)):"edit"===e?(k(),l.value.uuid="",l.value.initialText=s.value.text,l.value.uuid=t,l.value.action="edit"):"reply"===e&&(C(),r.value={replyMessage:s.value.text,uuid:t,action:e})},A=()=>{const e=document.querySelectorAll(".chat__message-content");[...e].forEach((e=>{e.classList.contains("selected")&&e.classList.remove("selected")})),o.value={uuid:null,action:null}},C=()=>{l.value={initialText:"",action:null,uuid:""},a.value=""},k=()=>{r.value={replyMessage:"",uuid:"",action:null}};return(0,n.YP)((()=>o),(()=>{o.value.uuid?.length||"massDelete"!==o.value.action||(o.value.action=null,o.value.uuid=null);const e=document.querySelector(".textarea__chat-mass-del-btn");e&&("massDelete"===o.value.action?e.style.width="60px":e.style.width="0px")}),{deep:!0}),(0,n.YP)(d,(()=>{A(),C()})),{getChatData:y,getChat:h,addMessage:f,deleteMessage:x,setMessageAction:M,getModalState:m,closeModal:v,openModal:p,setMessage:w,editMessage:_,resetEditingMessage:C,resetReplyMessage:k,resetSelectedMessages:A,chat:e,textarea:a,selectedMessage:s,replyActionsWithMessage:r,editActionsWithMessage:l,singleDeleteMessage:c,massDeleteMessage:o}}));var v=a(7183);const m={key:0,class:"chat__quote"},h={class:"chat-message-text"},y=["id","onClick"],f=["data-src"],_={key:0,class:"chat__message-image-quantity"},x={class:"chat-message-image-text"};var w=(0,n.aZ)({__name:"ChatMessageComponent",props:{message:{type:Object}},emits:["contextMenu"],setup(e,{emit:t}){const a=e,o=(0,i.iH)(),u=p(),d=(0,v.t)();function g(e){u.setMessageAction("massDelete",e),o.value.classList.toggle("selected")}function w(e,n){u.setMessage(a.message.message,a.message.uuid),t("contextMenu",e,n)}return(e,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__message-content",ref_key:"message",ref:o,onClick:t[2]||(t[2]=e=>g(a.message?.uuid))},[a.message?.message&&!a.message?.images.length?((0,n.wg)(),(0,n.iD)("div",{key:0,onClick:t[0]||(t[0]=(0,r.iM)((e=>w(e,a.message?.uuid)),["stop"])),class:(0,s.C_)(["chat__message",[(0,i.SU)(d).getAuthUser().id===a.message?.sender.id?"sender":"receiver"]])},[a.message?.replyMessage?((0,n.wg)(),(0,n.iD)("p",m,(0,s.zw)(a.message?.replyMessage),1)):(0,n.kq)("",!0),(0,n._)("p",h,(0,s.zw)(a.message?.message),1)],2)):(0,n.kq)("",!0),a.message?.images&&a.message?.images.length?((0,n.wg)(),(0,n.iD)("div",{key:1,onClick:t[1]||(t[1]=(0,r.iM)((()=>{}),["stop"])),class:(0,s.C_)(["chat__message-image-container",[(0,i.SU)(d).getAuthUser().id===a.message?.sender.id?"sender-images":"receiver-images",a.message?.images.length<=4?`pictures${a.message?.images.length}`:"picturesSlider"]])},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.message?.images,((e,t)=>((0,n.wg)(),(0,n.j4)(c.Z,{key:e.id,index:t,imagesLength:a.message?.images.length,images:a.message?.images},{image:(0,n.w5)((({show:c})=>[t<5?((0,n.wg)(),(0,n.iD)("div",{key:0,id:`image${t+1}`,onClick:(0,r.iM)(c,["stop"]),class:"chat__message-image"},[(0,n.wy)((0,n._)("img",{style:(0,s.j5)(t+1===5&&a.message?.images.length+1>5?"opacity: 0.2; z-index: 1;":"opacity: 1"),"data-src":`/${e.preview}`},null,12,f),[[(0,i.SU)(l.C)]]),t+1===5&&a.message?.images.length+1>5?((0,n.wg)(),(0,n.iD)("div",_,[(0,n._)("h3",null,"+"+(0,s.zw)(a.message?.images.length-5),1)])):(0,n.kq)("",!0)],8,y)):(0,n.kq)("",!0)])),_:2},1032,["index","imagesLength","images"])))),128)),(0,n._)("p",x,(0,s.zw)(a.message?.message),1)],2)):(0,n.kq)("",!0)],512))}}),M=a(89);const A=(0,M.Z)(w,[["__scopeId","data-v-75f72c17"]]);var C=A;const k={class:"chat__message-day"},D={class:"chat__message-container"};var b=(0,n.aZ)({__name:"ChatDayComponent",props:{messages:{type:Object},date:{type:String}},emits:["contextMenu"],setup(e,{emit:t}){const a=e;function i(e,a){t("contextMenu",e,a)}return(t,r)=>((0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",k,(0,s.zw)(a.date),1),(0,n._)("div",D,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.messages,(e=>((0,n.wg)(),(0,n.j4)(C,{key:e.id,onContextMenu:i,message:e},null,8,["message"])))),128))])],64))}});const U=(0,M.Z)(b,[["__scopeId","data-v-b5c4978a"]]);var S=U;const T=e=>((0,n.dD)("data-v-f7f838de"),e=e(),(0,n.Cn)(),e),H=T((()=>(0,n._)("button",{class:"chat-context-menu-btn"},"Добавить файлы",-1)));var I=(0,n.aZ)({__name:"ChatContextMenu",props:["clientX","clientY"],emits:["close-context-menu"],setup(e,{emit:t}){const a=p();function r(){a.setMessageAction("reply",a.selectedMessage.uuid)}function l(){a.setMessageAction("edit",a.selectedMessage.uuid)}return(t,c)=>((0,n.wg)(),(0,n.iD)("div",{onClick:c[3]||(c[3]=e=>t.$emit("close-context-menu")),class:"chat__context-menu",style:(0,s.j5)({left:e.clientX+"px",top:e.clientY+"px"})},[H,(0,n._)("button",{onClick:c[0]||(c[0]=e=>r()),class:"chat-context-menu-btn"}," Ответить "),(0,n._)("button",{onClick:c[1]||(c[1]=e=>l()),class:"chat-context-menu-btn"}," Редактировать "),(0,n._)("button",{onClick:c[2]||(c[2]=e=>(0,i.SU)(a).openModal("delete")),class:"chat-context-menu-btn"}," Удалить ")],4))}});const z=(0,M.Z)(I,[["__scopeId","data-v-f7f838de"]]);var E=z,W=a(1669),Y=a(4999);const V={class:"modal__text-delete"},q={class:"modal__del-buttons"};var O=(0,n.aZ)({__name:"ChatListComponent",props:{routeId:{type:Number,required:!0}},emits:["isContextMenu"],setup(e,{emit:t}){const a=e,l=p(),c=(0,v.t)(),o=(0,i.iH)({isActive:!1,uuid:null}),u=(0,i.iH)(0),d=(0,i.iH)(0),g=(0,i.iH)();function m(e,a){t("isContextMenu"),!1===o.value.isActive?(y(e),o.value.isActive=!o.value.isActive):y(e),o.value.uuid=a}function h(){t("isContextMenu"),o.value.uuid=null,o.value.isActive=!o.value.isActive}function y(e){let t=document.documentElement.clientWidth/2,a=document.documentElement.clientHeight/2;const n=document.querySelector(".admin-page__sidebar").clientWidth;let i=window.innerWidth-(g.value.clientWidth+n);t<e.pageX?u.value=Math.floor(e.clientX-(i/2+n)-130):u.value=Math.floor(e.clientX-(i/2+n)+10),a<e.clientY?d.value=e.clientY+g.value.scrollTop-280:d.value=e.clientY+g.value.scrollTop-120}function f(e){let t=e.created_at.slice(0,16).replace("T"," "),a=t.split(/[- :]/),n=new Date(Date.UTC(a[0],a[1]-1,a[2],a[3],a[4]));return n}(0,n.bv)((()=>l.getChat(a.routeId,c.getAuthUser().id))),(0,n.Ah)((()=>l.chat=[]));const _=(0,n.Fl)((()=>{const e=l.getChatData()?.reduce(((e,t)=>{const a=f(t).toLocaleString().slice(0,10);return e[a]=e[a]||[],e[a].push(t),e}),{});return e}));return(e,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat",ref_key:"chatBlock",ref:g},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(_.value,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"chat__messages",key:e[0].id},[(0,n.Wm)(S,{messages:e,date:t,onContextMenu:m},null,8,["messages","date"])])))),128)),o.value.isActive?(0,n.wy)(((0,n.wg)(),(0,n.j4)(E,{key:0,clientX:u.value,clientY:d.value,onCloseContextMenu:h},null,8,["clientX","clientY"])),[[(0,i.SU)(Y.V),h]]):(0,n.kq)("",!0),(0,n.Wm)(r.uT,{name:"opacity"},{default:(0,n.w5)((()=>[(0,i.SU)(l).getModalState()?((0,n.wg)(),(0,n.j4)(W.Z,{key:0,onCloseModal:t[2]||(t[2]=e=>(0,i.SU)(l).closeModal())},{header:(0,n.w5)((()=>[(0,n._)("p",V," Вы действительно хотите удалить "+(0,s.zw)(1==(0,i.SU)(l).massDeleteMessage.uuid?.length||"delete"===(0,i.SU)(l).singleDeleteMessage.action?"это сообщение":"эти сообщения")+"? ",1)])),body:(0,n.w5)((()=>[(0,n._)("div",q,[(0,n._)("button",{class:"btn",onClick:t[0]||(t[0]=e=>(0,i.SU)(l).deleteMessage())}," Да "),(0,n._)("button",{class:"btn",onClick:t[1]||(t[1]=e=>(0,i.SU)(l).closeModal())}," Нет ")])])),_:1})):(0,n.kq)("",!0)])),_:1})],512))}});const R=(0,M.Z)(O,[["__scopeId","data-v-f8a82484"]]);var j=R;const B="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Z={randomUUID:B};a(1439),a(7585),a(5315);let L;const P=new Uint8Array(16);function $(){if(!L&&(L="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!L))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return L(P)}const F=[];for(let ze=0;ze<256;++ze)F.push((ze+256).toString(16).slice(1));function K(e,t=0){return F[e[t+0]]+F[e[t+1]]+F[e[t+2]]+F[e[t+3]]+"-"+F[e[t+4]]+F[e[t+5]]+"-"+F[e[t+6]]+F[e[t+7]]+"-"+F[e[t+8]]+F[e[t+9]]+"-"+F[e[t+10]]+F[e[t+11]]+F[e[t+12]]+F[e[t+13]]+F[e[t+14]]+F[e[t+15]]}function X(e,t,a){if(Z.randomUUID&&!t&&!e)return Z.randomUUID();e=e||{};const n=e.random||(e.rng||$)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=n[e];return t}return K(n)}var N=X,Q=a(7955);const G=e=>((0,n.dD)("data-v-04337cea"),e=e(),(0,n.Cn)(),e),J={class:"textarea-wrapper"},ee=G((()=>(0,n._)("svg",{viewBox:"0 0 448 512"},[(0,n._)("path",{d:"M364.2 83.8c-24.4-24.4-64-24.4-88.4 0l-184 184c-42.1 42.1-42.1 110.3 0 152.4s110.3 42.1 152.4 0l152-152c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-152 152c-64 64-167.6 64-231.6 0s-64-167.6 0-231.6l184-184c46.3-46.3 121.3-46.3 167.6 0s46.3 121.3 0 167.6l-176 176c-28.6 28.6-75 28.6-103.6 0s-28.6-75 0-103.6l144-144c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-144 144c-6.7 6.7-6.7 17.7 0 24.4s17.7 6.7 24.4 0l176-176c24.4-24.4 24.4-64 0-88.4z"})],-1))),te=[ee],ae={class:"textarea__attach-image-preview-container"},ne=["src"],ie=["onClick"],se=G((()=>(0,n._)("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"},null,-1))),re=[se],le=["placeholder"],ce=["disabled"],oe=["disabled"],ue={key:0,class:"textarea__attach-menu"},de=G((()=>(0,n._)("svg",{viewBox:"0 0 512 512"},[(0,n._)("path",{d:"M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6h96 32H424c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"})],-1))),ge=G((()=>(0,n._)("p",null,"Прикрепить картинку",-1))),pe=[de,ge],ve=G((()=>(0,n._)("svg",{viewBox:"0 0 384 512"},[(0,n._)("path",{d:"M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128z"})],-1))),me=G((()=>(0,n._)("p",null,"Прикрепить файл",-1))),he=[ve,me];var ye=(0,n.aZ)({__name:"ChatTextareaComponent",props:{routeId:{type:Number,required:!0}},setup(e){const t=e,a=(0,v.t)(),l=p(),c=((0,Q.d)(),(0,i.iH)(!1)),o=(0,i.iH)(!0),d=(0,i.iH)(0),g=(0,i.iH)(),m=(0,i.iH)([]),h=(0,i.iH)(null),y=(0,i.iH)([]),f=e=>{y.value=[],m.value=[];let t=e.target.files;for(let a=0;a<t.length;a++){let e=t[a];if(!e.type.match("image.*"))return;y.value.push({image:e,id:a});let n=new FileReader;n.onload=function(e){m.value.push({image:e.target.result,id:a})},n.readAsDataURL(e)}h.value=null};function _(){c.value=!c.value}function x(){document.getElementById("attach-image")?.click(),console.log("картинка")}function w(e){y.value=y.value.filter((t=>t.id!=e)),m.value=m.value.filter((t=>t.id!=e))}function M(){console.log("файл")}function A(e){if("edit"!==l.editActionsWithMessage.action){if(""!==l.textarea.trim()||y.value.length)if(e.ctrlKey||"click"==e.type){const e=N(),n=l.replyActionsWithMessage.replyMessage||"",i=l.textarea,s=new FormData;if(s.append("uuid",e),s.append("to",t.routeId||1),s.append("from",a.getAuthUser().id),s.append("replyMessage",n),s.append("message",i),y.value.length)for(let t=0;t<y.value.length;t++){let e=y.value[t].image;s.append(`images[${t}]`,e)}u().post("/api/chat",s).then((e=>{e.data.images.length&&C(e.data)}));const r={uuid:e,message:i||null,replyMessage:n,created_at:(new Date).toISOString(),new:1,created_at_for_humans:"sending",sender:{id:a.user.id,name:a.user.username,admin:a.user.isAdmin?1:0},files:[],images:[]};l.addMessage(r),y.value=[],m.value=[],l.textarea="",g.value.style.height="24px"}else{let t=e.target.selectionStart;e.target.setRangeText("\n",t,t,"end"),l.textarea=e.target.value}}else k()}function C(e){const t=l.getChatData()?.filter((t=>t.uuid===e.uuid));t[0].images=t[0].images.concat(e.images)}function k(){""!==l.textarea.trim()&&(u().patch(`/api/chat/${l.editActionsWithMessage.uuid}`,{message:l.textarea}),l.editMessage(l.textarea)),l.textarea=""}function D(e){let t=l.textarea,a=e.target.selectionStart,n=t.slice(0,a),i=t.slice(a);l.textarea=`${n}\t${i}`,e.target.value=l.textarea,e.target.selectionEnd=e.target.selectionStart=a+1}return(0,n.YP)((()=>l.editActionsWithMessage.uuid),(()=>{"edit"===l.editActionsWithMessage.action?l.textarea=l.selectedMessage.text:l.textarea=""})),(0,n.YP)((()=>[l.textarea,y.value]),(()=>""!=l.textarea.trim()||y.value.length?o.value=!1:o.value=!0)),(e,t)=>((0,n.wg)(),(0,n.iD)("div",J,[(0,n._)("button",{onClick:t[0]||(t[0]=(0,r.iM)((e=>c.value=!0),["stop"])),class:"textarea__chat-attach-btn"},te),(0,n._)("div",ae,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(m.value,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"textarea__attach-image-preview",key:e.id},[(0,n._)("img",{class:"textarea__attach-image",src:e.image},null,8,ne),((0,n.wg)(),(0,n.iD)("svg",{onClick:t=>w(e.id),class:"textarea__attach-image-delete",viewBox:"0 0 512 512",fill:"white",stroke:"black","stroke-width":"5"},re,8,ie))])))),128))]),(0,n._)("div",null,[((0,n.wg)(),(0,n.iD)("input",{onChange:f,key:d.value,type:"file",multiple:"",style:{display:"none"},id:"attach-image",accept:"image/x-png,image/gif,image/jpeg"},null,32))]),(0,n.wy)((0,n._)("textarea",{ref_key:"chatTextarea",ref:g,placeholder:y.value.length?"Добавить описание...":"Написать сообщение...",onKeyup:t[1]||(t[1]=(0,r.D2)((0,r.iM)((e=>A(e)),["ctrl"]),["enter"])),onKeydown:t[2]||(t[2]=(0,r.D2)((0,r.iM)((e=>D(e)),["exact","prevent"]),["tab"])),"onUpdate:modelValue":t[3]||(t[3]=e=>(0,i.SU)(l).textarea=e),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"',class:"textarea__chat"},null,40,le),[[r.nr,(0,i.SU)(l).textarea]]),"edit"===(0,i.SU)(l).editActionsWithMessage.action?((0,n.wg)(),(0,n.iD)("button",{key:0,class:(0,s.C_)(["textarea__chat-edit-btn",{inputDisable:!0===o.value}]),disabled:o.value,onClick:k},null,10,ce)):((0,n.wg)(),(0,n.iD)("button",{key:1,class:(0,s.C_)(["textarea__chat-send-btn",{inputDisable:!0===o.value}]),onClick:t[4]||(t[4]=e=>A(e)),disabled:o.value}," Отправить ",10,oe)),(0,n.Wm)(r.uT,{name:"attach"},{default:(0,n.w5)((()=>[c.value?(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",ue,[(0,n._)("button",{class:"attach-image-btn",onClick:t[5]||(t[5]=e=>x())},pe),(0,n._)("button",{class:"attach-file-btn",onClick:t[6]||(t[6]=e=>M())},he)])),[[(0,i.SU)(Y.V),_]]):(0,n.kq)("",!0)])),_:1})]))}});const fe=(0,M.Z)(ye,[["__scopeId","data-v-04337cea"]]);var _e=fe;const xe=e=>((0,n.dD)("data-v-68f5a781"),e=e(),(0,n.Cn)(),e),we={class:"chat-wrapper"},Me={key:0,class:"chat-wrapper__backdrop"},Ae={key:1,class:"chat-textarea-container"},Ce=xe((()=>(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg","clip-rule":"evenodd","fill-rule":"evenodd","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision","image-rendering":"optimizeQuality",viewBox:"0 0 456 511.82"},[(0,n._)("path",{d:"M48.42 140.13h361.99c17.36 0 29.82 9.78 28.08 28.17l-30.73 317.1c-1.23 13.36-8.99 26.42-25.3 26.42H76.34c-13.63-.73-23.74-9.75-25.09-24.14L20.79 168.99c-1.74-18.38 9.75-28.86 27.63-28.86zM24.49 38.15h136.47V28.1c0-15.94 10.2-28.1 27.02-28.1h81.28c17.3 0 27.65 11.77 27.65 28.01v10.14h138.66c.57 0 1.11.07 1.68.13 10.23.93 18.15 9.02 18.69 19.22.03.79.06 1.39.06 2.17v42.76c0 5.99-4.73 10.89-10.62 11.19-.54 0-1.09.03-1.63.03H11.22c-5.92 0-10.77-4.6-11.19-10.38 0-.72-.03-1.47-.03-2.23v-39.5c0-10.93 4.21-20.71 16.82-23.02 2.53-.45 5.09-.37 7.67-.37zm83.78 208.38c-.51-10.17 8.21-18.83 19.53-19.31 11.31-.49 20.94 7.4 21.45 17.57l8.7 160.62c.51 10.18-8.22 18.84-19.53 19.32-11.32.48-20.94-7.4-21.46-17.57l-8.69-160.63zm201.7-1.74c.51-10.17 10.14-18.06 21.45-17.57 11.32.48 20.04 9.14 19.53 19.31l-8.66 160.63c-.52 10.17-10.14 18.05-21.46 17.57-11.31-.48-20.04-9.14-19.53-19.32l8.67-160.62zm-102.94.87c0-10.23 9.23-18.53 20.58-18.53 11.34 0 20.58 8.3 20.58 18.53v160.63c0 10.23-9.24 18.53-20.58 18.53-11.35 0-20.58-8.3-20.58-18.53V245.66z"})],-1))),ke={key:0,class:"textarea__chat-mass-del-count"},De=xe((()=>(0,n._)("p",{class:"textarea__chat-edit-title"},"Редактировать",-1))),be={class:"textarea__chat-edit-text"},Ue=xe((()=>(0,n._)("p",{class:"textarea__chat-reply-title"},"Ответить на сообщение",-1))),Se={class:"textarea__chat-reply-text"};var Te=(0,n.aZ)({__name:"ChatComponent",setup(e){const t=(0,g.yj)(),a=((0,v.t)(),(0,Q.d)()),l=p(),c=(0,i.iH)(!1);function o(e){return e.length>23?e.slice(0,25)+"...":e}return(e,u)=>((0,n.wg)(),(0,n.iD)("section",we,[c.value?((0,n.wg)(),(0,n.iD)("div",Me)):(0,n.kq)("",!0),"massDelete"===(0,i.SU)(l).massDeleteMessage.action?((0,n.wg)(),(0,n.iD)("div",Ae,[(0,n._)("div",{class:"textarea__chat-mass-del-btn",onClick:u[0]||(u[0]=e=>(0,i.SU)(l).openModal())},[Ce,"massDelete"===(0,i.SU)(l).massDeleteMessage.action?((0,n.wg)(),(0,n.iD)("p",ke,[(0,n._)("b",null,(0,s.zw)((0,i.SU)(l).massDeleteMessage.uuid?.length),1)])):(0,n.kq)("",!0)]),(0,n._)("div",{class:"close-cross reset-mass-del",onClick:u[1]||(u[1]=e=>(0,i.SU)(l).resetSelectedMessages())})])):(0,n.kq)("",!0),(0,n.wy)((0,n._)("div",{class:"chat-name"},(0,s.zw)((0,i.SU)(t).query.name),513),[[r.F8,!(0,i.SU)(a).adminSidebar.isOpen]]),(0,n.Wm)(j,{routeId:+(0,i.SU)(t).params.id,onIsContextMenu:u[2]||(u[2]=e=>c.value=!c.value)},null,8,["routeId"]),(0,n._)("div",{class:(0,s.C_)("textarea__chat-edit-preview"+("edit"===(0,i.SU)(l).editActionsWithMessage.action?"--active":""))},[De,(0,n._)("p",be,(0,s.zw)(o((0,i.SU)(l).editActionsWithMessage.initialText)),1),(0,n._)("div",{onClick:u[3]||(u[3]=function(){(0,i.SU)(l).resetEditingMessage()}),class:"close-cross close-edit-info"})],2),(0,n._)("div",{class:(0,s.C_)("textarea__chat-reply-preview"+("reply"===(0,i.SU)(l).replyActionsWithMessage.action?"--active":""))},[Ue,(0,n._)("p",Se,(0,s.zw)(o((0,i.SU)(l).replyActionsWithMessage.replyMessage)),1),(0,n._)("div",{onClick:u[4]||(u[4]=function(){(0,i.SU)(l).resetReplyMessage()}),class:"close-cross close-reply-info"})],2),(0,n.Wm)(_e,{routeId:+(0,i.SU)(t).params.id},null,8,["routeId"])]))}});const He=(0,M.Z)(Te,[["__scopeId","data-v-68f5a781"]]);var Ie=He}}]);
//# sourceMappingURL=499.44a82c4f.js.map